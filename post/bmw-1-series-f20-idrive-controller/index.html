<!doctype html><html lang=en><head><title>Bmw 1 series f20 i drive controller hacking with arduino and pi | The Adventures of Arran Short</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=keywords content="The Adventures of Arran Short"><meta property="og:locale" content="en)_US"><meta property="og:type" content="article"><meta property="og:title" content="BMW 1 series F20 iDrive controller hacking with arduino and PI"><meta property="og:description" content="As part of a larger in car entertainment project, I needed a simple and safe input method to control the software that wasn’t a touch screen. As BMWs are"><meta property="og:url" content="https://arranshort.xyz/post/bmw-1-series-f20-idrive-controller/"><meta property="og:image" content="https://arranshort.xyz/images/images/2017/04/20170131_215600-1.jpg"><link rel=canonical href=https://arranshort.xyz/post/bmw-1-series-f20-idrive-controller/><link rel=apple-touch-icon sizes=180x180 href=https://arranshort.xyz/images/icons/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=https://arranshort.xyz/images/icons/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=https://arranshort.xyz/images/icons/favicon-16x16.png><link rel=manifest href=https://arranshort.xyz/images/icons/site.webmanifest><link rel=stylesheet href=https://arranshort.xyz/css/styles.86c6da248e485cdc7f340baeb04c29cf0499e12a33a387104028f046c1d4ba15aa3ef8a4bf8f44a2fba7f0263053fa54dc4d2f2baa3d6c8ebb3c69f7bdbded2b.css integrity="sha512-hsbaJI5IXNx/NAuusEwpzwSZ4Sozo4cQQCjwRsHUuhWqPvikv49Eovun8CYwU/pU3E0vK6o9bI67PGn3vb3tKw=="></head><body><div class=nav-drop><div class=nav-body><div class=nav-close></div><div class=color_mode><label for=mode>Toggle Dark Mode</label>
<input type=checkbox class=color_choice id=mode></div></div></div><header class=nav><nav class=nav-menu><a href=https://arranshort.xyz/ class="nav-brand nav_item">The Adventures of Arran Short</a><div class=nav_bar-wrap><div class=nav_bar></div></div></nav></header><main><div class="wrap mt post"><div><p class=post_date>01. February 2017</p><h1 class=post_title>BMW 1 series F20 iDrive controller hacking with arduino and PI</h1><div class=post_body><div class=post_inner><img src=https://arranshort.xyz/images/images/2017/04/20170131_215600-1.jpg alt=/images/2017/04/20170131_215600-1.jpg class=post_thumbnail><p>As part of a larger in car entertainment project, I needed a simple and safe input method to control the software that wasn’t a touch screen. As BMWs are popular in the car PC scene I thought I’d buy an IDrive controller as surely there will be an Arduino lib to get it working.</p><p>Nope, there are a few pages of people giving out tiny bits of information or claiming to have done it but haven’t shared it on the Web.</p><p>The one piece of helpful information I did pull from the aforementioned websites was the fact that these controllers use a low speed  ( 100kbit for BMW ) fault tolerant CANbus transceiver, the TJA1054 or TJA1055.</p><p>Some more googling pointed out that the MCP2551 I normally use wasn’t going to work and I needed to use the TJA1054/5</p><p>The frugal/lazy part of me didn’t want to have to make up a PCB board straight away for the TJA1054 before it was tested and I was more familiar with it.</p><p>In comes a VAG CANbus gateway. These handy devices are how VAG manage the different speed CANbus networks at the obd2 port. TL;DR these are a cheap board with 2x TJA1054, 2x high-speed transceivers and a 5v regulator.</p><p>After removing the NEC Cpu from the gateway I connected one of the low-speed transceivers to an Arduino with my DIY MCP2515 shield and the other to a PI zero with an MCP2515 canpi hat.</p><p>The first controller I tried was from an e60 which has 2 external buttons and the twist joystick.</p><p>With any can frames on the bus this would reply with 0x4e7 messages, turns out there isn’t much info on these and I couldn’t find any example of someone getting it to work.</p><p>The second was from a 2012 1 series this is the lower spec model that only has the 5 buttons and the left-right joystick with a rotary encoder.</p><p>Everyone seems to know that sending frames to 0x202 will enable the lights but no other information exists to explain how to get it to reply back with button presses.</p><p>So it’s time to brute force the CANbus. a tiny bit of Arduino code later got me sending 8 bytes of 0xff to every 11bit ID twice every 100ms while I repeatedly pressed the buttons.</p><p>With both eyes on Wireshark, it gets to the 0x500 numbers and thing replies start happening then the magic number appears 0x535 this is the ID that will keep the device awake and will allow you to get the frames for button presses.</p><p>This sadly doesn’t give any data for the rotary encoder but I thing that may need extra data to “initialize”.</p><p>I’ll be doing some more testing to get the rotary encoder working as well as some code to use this a hid device.</p><p>Keep an eye out for that!</p><p><img src=/content/images/2017/04/20170131_215801.jpg alt></p></div><div class="post_extra mb-2"><div class=copy data-before="Share Story" data-after="Link Copied"><svg class="icon"><use xlink:href="#copy"/></svg></div></div><div></div></div></div><a href=https://arranshort.xyz/ class=post_nav><span class=post_next>The Latest<svg class="icon icon_scale"><use xlink:href="#double-arrow"/></svg></span></a></div></main><footer class="footer wrap pale"><p>&copy;&nbsp;<span class=year></span>&nbsp;The Adventures of Arran Short</p><p class="attribution upcase">Designed by <a href="<no value>" target=_blank title="Linkedin Profile" rel=nonopener><no value></a></p></footer><script src=https://arranshort.xyz/js/index.min.974e37b2a16b2a8475f320f64202dfd6fdb1b2758b99f3fb3612645d27f103f24a9bdae10dc80d6d52edd9b7893a2ef3ececbcaa5771e09a00e7f6d87a55b829.js></script><svg width="0" height="0" class="hidden"><symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 699.428 699.428" id="copy"><path d="M502.714.0H240.428C194.178.0 153 42.425 153 87.429l-25.267.59c-46.228.0-84.019 41.834-84.019 86.838V612c0 45.004 41.179 87.428 87.429 87.428H459c46.249.0 87.428-42.424 87.428-87.428h21.857c46.25.0 87.429-42.424 87.429-87.428v-349.19L502.714.0zM459 655.715H131.143c-22.95.0-43.714-21.441-43.714-43.715V174.857c0-22.272 18.688-42.993 41.638-42.993l23.933-.721v393.429C153 569.576 194.178 612 240.428 612h262.286c0 22.273-20.765 43.715-43.714 43.715zm153-131.143c0 22.271-20.765 43.713-43.715 43.713H240.428c-22.95.0-43.714-21.441-43.714-43.713V87.429c0-22.272 20.764-43.714 43.714-43.714H459c-.351 50.337.0 87.975.0 87.975.0 45.419 40.872 86.882 87.428 86.882H612v306zm-65.572-349.715c-23.277.0-43.714-42.293-43.714-64.981V44.348L612 174.857h-65.572zm-43.714 131.537H306c-12.065.0-21.857 9.77-21.857 21.835s9.792 21.835 21.857 21.835h196.714c12.065.0 21.857-9.771 21.857-21.835.0-12.065-9.792-21.835-21.857-21.835zm0 109.176H306c-12.065.0-21.857 9.77-21.857 21.834.0 12.066 9.792 21.836 21.857 21.836h196.714c12.065.0 21.857-9.77 21.857-21.836.0-12.064-9.792-21.834-21.857-21.834z"/></symbol><symbol viewBox="0 0 53 42" xmlns="http://www.w3.org/2000/svg" id="double-arrow"><path d="M.595 39.653a1.318 1.318.0 010-1.864L16.55 21.833a1.318 1.318.0 000-1.863L.595 4.014a1.318 1.318.0 010-1.863L2.125.62a1.318 1.318.0 011.864.0l19.35 19.349a1.318 1.318.0 010 1.863l-19.35 19.35a1.318 1.318.0 01-1.863.0zm29 0a1.318 1.318.0 010-1.864L45.55 21.833a1.318 1.318.0 000-1.863L29.595 4.014a1.318 1.318.0 010-1.863l1.53-1.53a1.318 1.318.0 011.864.0l19.35 19.349a1.318 1.318.0 010 1.863l-19.35 19.35a1.318 1.318.0 01-1.863.0z"/></symbol></svg></body></html>